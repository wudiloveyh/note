# ä¸»æœºä¿¡æ¯æ”¶é›†

## ä¸»æœºä¿¡æ¯æ”¶é›†éœ€è¦æ”¶é›†å“ªäº›å†…å®¹

### åŸºæœ¬ä¸»æœºä¿¡æ¯

åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„æ¼æ´ã€è¡¥ä¸ç¡®å®ã€æ˜¯å¦å¯ä»¥ææƒ

- æ“ä½œç³»ç»Ÿç‰ˆæœ¬

  ```diff
  - windows
  systeminfo | findstr OS
  ver
  reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion" /v ProductName
  - linux
  cat /etc/os-release
  ```

- è¡¥ä¸æƒ…å†µ

  ```diff
  - windows
  systeminfo | findstr KB
  wmic qfe list brief
  - linux 
  apt list --installed
  rpm -qa --last
  ```

- ç³»ç»Ÿæ¶æ„

  ```diff
  - windows
  systeminfo
  echo %PROCESSOR_ARCHITECTURE%
  wmic os get osarchitecture
  - linux
  uname -m
  # æŸ¥çœ‹cpuæ¶æ„
  lscpu
  # æŸ¥çœ‹å†…æ ¸æ¶æ„
  uname -a 
  ```

- ä¸»æœºå

  ```diff
  + windowså’Œlinuxéƒ½å¯ä»¥æ‰§è¡ŒhostnameæŸ¥çœ‹
  hostname
  - winodws
  echo %COMPUTERNAME%
  - linuxè¯¦ç»†
  hostnamectl
  ```

- ç³»ç»Ÿè¿è¡Œæ—¶é—´

  ```diff
  - windows
  systeminfo | findstr "ç³»ç»Ÿå¯åŠ¨æ—¶é—´"
  net statistics workstation
  - linux
  uptime
  ```

- æ˜¯å¦æ˜¯è™šæ‹Ÿæœºè¿è¡Œ

  ```diff
  - windows
  wmic computersystem get model, manufacturer
  (Get-WmiObject Win32_ComputerSystem).Manufacturer
  + å¦‚æœè¾“å‡ºä¸‹é¢çš„è¡¨æ ¼çš„å†…å®¹å°±å¤§æ¦‚æ˜¯è™šæ‹Ÿæœºäº†
  ```

  | è™šæ‹Ÿæœºç±»å‹ | å…¸å‹ Manufacturer / Model               |
  | ---------- | --------------------------------------- |
  | VMware     | VMware, Inc. / VMware Virtual Platform  |
  | VirtualBox | innotek GmbH / VirtualBox               |
  | Hyper-V    | Microsoft Corporation / Virtual Machine |
  | KVM / QEMU | QEMU / Standard PC (Q35 + ICH9)         |
  | Xen        | Xen / HVM domU                          |

  ![image-20251115160138583](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115160138658.png)

  çœŸå®ç‰©ç†æœºä¼šæ˜¾ç¤ºï¼š

  ```diff
  LENOVO
  DELL
  HP
  ASUS
  Acer
  ```

  ![image-20251115160145566](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115160145631.png)

  ä¹Ÿå¯ä»¥æŸ¥çœ‹macåœ°å€åˆ¤æ–­ï¼š

  ```diff
  getmac
  ```

  linux:

  ```diff
  egrep -i 'hypervisor|vmx|svm' /proc/cpuinfo
  ```

  - å¦‚æœå‡ºç° `hypervisor` å­—æ®µ â†’ ä¸€èˆ¬è¯´æ˜è¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­
  - `vmx` â†’ Intel VT-xï¼ˆç¡¬ä»¶è™šæ‹ŸåŒ–ï¼‰
  - `svm` â†’ AMD-Vï¼ˆç¡¬ä»¶è™šæ‹ŸåŒ–ï¼‰

- æ˜¯å¦å­˜åœ¨åŸŸç¯å¢ƒ

  ```diff
  systeminfo | findstr "åŸŸ"
  systeminfo | findstr "Domain"
  ```

  ![image-20251115160738146](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115160738201.png)

### ç”¨æˆ·å’Œæƒé™ä¿¡æ¯

åˆ¤æ–­èƒ½å¦ææƒã€æ¨ªå‘ç§»åŠ¨æ˜¯å¦æœ‰å‡­æ®ã€æ˜¯å¦æœ‰ç‰¹æƒç”¨æˆ·

#### æœ¬åœ°ç”¨æˆ·ä¿¡æ¯

- æœ¬åœ°ç”¨æˆ·åˆ—è¡¨

  ```diff
  - windows
  net user
  - linux 
  cat /etc/passwd
  + åˆ—å‡ºå½“å‰ç™»å½•ç”¨æˆ·
  who
  + åˆ—å‡ºæ‰€æœ‰ç™»å½•è¿‡çš„ç”¨æˆ·
  last
  ```

- ç”¨æˆ·SID

  ```diff
  - windows
  wmic useraccount get name,sid
  Get-WmiObject Win32_UserAccount -Filter "LocalAccount=True" | Select Name,SID
  - linux
  + Linux æ²¡æœ‰ Windows SIDï¼Œä½† UID/GID èµ·ç±»ä¼¼ä½œç”¨ã€‚
  id username
  ```

- ç”¨æˆ·æ˜¯å¦ç¦ç”¨/å¯ç”¨

  ```diff
  - windows
  wmic useraccount get name,disabled
  Get-WmiObject Win32_UserAccount -Filter "LocalAccount=True" | Select Name,Disabled
  - linux
  + æœ‰å®é™…å¯†ç å°±æ˜¯å¯ç”¨ï¼Œæ²¡æœ‰çš„è¯æ˜¯***ï¼Œç„¶åå¸¦æœ‰ä¸¤ä¸ªæ„Ÿå¹å·
  sudo cat /etc/shadow | grep username
  ```

- ç”¨æˆ·ç»„ã€ç®¡ç†å‘˜ç»„æˆå‘˜

  ```diff
  - windows
  net user username
  net localgroup Administrators
  - linux 
  groups username
  + è¾“å‡ºï¼šusernameï¼šä¸»ç»„ï¼Œåç»­çš„æ˜¯é™„åŠ ç»„
  cat /etc/group
  getent group sudo
  getent group wheel
  ```

#### æƒé™ç›¸å…³

- å½“å‰ç”¨æˆ·æƒé™

  ```diff
  - windows
  whoami /groups
  - linux 
  sudo -l
  ```

### å‡­è¯ç›¸å…³ä¿¡æ¯ï¼ˆç›¸å½“é‡è¦ï¼‰

Windows æœ¬åœ°è´¦æˆ·çš„å¯†ç å“ˆå¸Œå­˜å‚¨åœ¨ **SAM æ–‡ä»¶** ä¸­ï¼ˆSecurity Accounts Managerï¼‰ã€‚

è·¯å¾„ï¼š

```diff
C:\Windows\System32\config\SAM
C:\Windows\System32\config\SYSTEM
```

- SAM æ–‡ä»¶å­˜å‚¨è´¦æˆ·å’Œ LM/NTLM å“ˆå¸Œ

- SYSTEM æ–‡ä»¶ç”¨äºè§£å¯† SAM ä¸­çš„å“ˆå¸Œ
- ä¸€èˆ¬æå–å‡­è¯éœ€è¦ç®¡ç†å‘˜æƒé™

æ¨ªå‘ç§»åŠ¨ã€ææƒçš„å…³é”®éƒ¨åˆ†

- æœ¬åœ°å¯†ç å“ˆå¸Œ

  ç”¨å·¥å…·å¯¼å‡º

  mimikatzï¼š

  é¡¹ç›®åœ°å€ï¼š

  https://github.com/gentilkiwi/mimikatz.git

  ```diff
  - åŸºæœ¬å‘½ä»¤ï¼Œè¦ç”¨ç®¡ç†å‘˜æƒé™è¿è¡Œ
  log mimi.log
  privilege::debug
  sekurlsa::logonpasswords
  exit
  + æŸ¥çœ‹mimi.logå°±å¯ä»¥çœ‹åˆ°æŠ“å–çš„å“ˆå¸Œ
  ```

  ![image-20251115170306010](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115170306075.png)

- å†…å­˜ä¸­æ˜æ–‡å¯†ç 

  å’Œä¸Šé¢çš„æ“ä½œä¸€æ ·ï¼Œè¿™é‡Œç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œä¸ç›´æ¥åœ¨ç›®æ ‡ä¸»æœºè¿è¡Œmimikatzï¼Œå…ˆç”¨procdumpæŠŠLSASSè¿›ç¨‹çš„å®Œæ•´å†…å­˜Dumpä¸‹æ¥ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶

  procdumpä¸‹è½½åœ°å€ï¼š

  https://download.sysinternals.com/files/Procdump.zip

  ```bash
  procdump -ma lsass.exe lsass.dmp
  # -mağŸ‘‰Full dumpï¼ŒåŒ…å«è¿›ç¨‹çš„ å®Œæ•´å†…å­˜ï¼Œå †æ ˆã€å †ã€å¥æŸ„ç­‰éƒ½ä¿å­˜ä¸‹æ¥
  mimikatz "sekurlsa::minidump lsass.dmp" "sekurlsa::logonpasswords"
  ```

  ![image-20251115175632702](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115175632767.png)

  windows7æˆ–è€…å…¶ä»–ç³»ç»Ÿå¦‚æœè¿è¡Œprocdumpå¤±è´¥ï¼Œå¯ä»¥å°è¯•è€ç‰ˆæœ¬

- æµè§ˆå™¨ä¿å­˜çš„å¯†ç 

  æ‰“å¼€æµè§ˆå™¨æŸ¥çœ‹ï¼Œä¸€èˆ¬éœ€è¦è¾“å…¥å¯†ç æ‰“å¼€å¯¹åº”çš„ä¿é™©ç®±

- è½¯ä»¶ä¿å­˜çš„å¯†ç 

  æŸäº›è½¯ä»¶ä¿å­˜çš„å¯†ç 

- sshç§é’¥

  æœ¬è´¨æ˜¯æ–‡ä»¶

  æ‰¾åˆ°å­˜æ”¾çš„ä½ç½®

  å¯èƒ½å­˜åœ¨çš„ä½ç½®ï¼š

  ```diff
  ~/.ssh/id_rsa
  ~/.ssh/id_ecdsa
  ~/.ssh/id_ed25519
  ~/.ssh/id_dsa
  /root/.ssh/
  /home/*/.ssh/
  /etc/ssh/ssh_host_rsa_keyï¼ˆä¸»æœºç§é’¥ï¼‰
  ```

  æ‰¾åˆ°åå¯ä»¥å°è¯•ç™»å½•ï¼š

  ```bash
  ssh -i id_rsa user@target
  ```

  å¦‚æœèƒ½å¤ŸæˆåŠŸç™»å½•çš„è¯å°±å­˜åœ¨å‡­è¯æ³„éœ²é£é™©

  ![image-20251115192335788](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115192336115.png)

  ä¸Šå›¾æ¼”ç¤ºäº†æŠŠç§é’¥çš„å†…å®¹å¤åˆ¶åˆ°1.txtä¸­ï¼Œåˆ©ç”¨è¿™ä¸ªç§é’¥æ–‡ä»¶æˆåŠŸå…å¯†ç™»å½•kali

- webåº”ç”¨é…ç½®æ–‡ä»¶å¯†ç 

  phpï¼š

  | æ¡†æ¶      | é…ç½®æ–‡ä»¶è·¯å¾„                         |
  | --------- | ------------------------------------ |
  | WordPress | `/var/www/html/wp-config.php`        |
  | ThinkPHP  | `application/database.php` æˆ– `.env` |
  | Laravel   | `.env`                               |
  | Discuz    | `config/config_global.php`           |

  java

  ```bash
  application.properties
  application.yml
  /opt/app/
  /usr/local/app/
  /usr/share/tomcat/webapps/xxx/
  ```

- DPAPIå­˜å‚¨çš„å‡­è¯

  **DPAPIï¼ˆData Protection APIï¼‰** æ˜¯ Windows å†…ç½®çš„æ•°æ®åŠ å¯†ä½“ç³»ï¼Œç”¨äºæŠŠæ•æ„Ÿæ•°æ®åŠ å¯†å¹¶å­˜å‚¨åœ¨ç³»ç»Ÿä¸­ã€‚

  æŸ¥çœ‹DPAPIç›®å½•ï¼š

  ç”¨æˆ·çº§

  ```bash
  dir C:\Users\<user>\AppData\Roaming\Microsoft\Protect\
  ```

  ç³»ç»Ÿçº§ï¼š

  ```bash
  dir C:\Windows\System32\Microsoft\Protect\
  ```

### ç½‘ç»œå’Œé€šä¿¡ä¿¡æ¯

ç”¨æ¥åˆ¤æ–­æ¨ªå‘ç§»åŠ¨æ˜¯å¦å¯è¡Œã€è·¯å¾„å’Œç½‘ç»œç»“æ„

##### IPå’Œç½‘ç»œä¿¡æ¯

- IPåœ°å€ã€å­ç½‘æ©ç ã€ç½‘å…³

  ```diff
  - windows
  ipconfig /all
  route print
  - linux
  ifconfig
  ip a 
  route -n
  ```

- DNSæœåŠ¡å™¨

  ```diff
  - windows
  ipconfig /all
  - linux
  cat /etc/resolv.conf
  ```

- hostsæ–‡ä»¶å†…å®¹

  ```diff
  - windows
  type C:\Windows\System32\drivers\etc\hosts
  - linux
  
  ```

  

- å¤šç½‘å¡æƒ…å†µ

##### è·¯ç”±ä¿¡æ¯

```bash
# windows
route print
# linux
route -n 
```

##### ç«¯å£/æœåŠ¡

- å½“å‰ä¸»æœºå¼€æ”¾çš„ç«¯å£
- ç›‘å¬çš„æœåŠ¡
- ç«¯å£å¯è¾¾æ€§æ£€æŸ¥ï¼ˆè¯´ä¸å®šå¤–éƒ¨æ— æ³•è®¿é—®ï¼‰

##### è¿æ¥æƒ…å†µ

- å½“å‰TCP/UDPè¿æ¥
- æ­£åœ¨è¿æ¥çš„å†…éƒ¨ç³»ç»Ÿï¼ˆMSSQLï¼‰

### å·²å®‰è£…çš„è½¯ä»¶å’ŒæœåŠ¡

ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨å¯åˆ©ç”¨çš„æ¼æ´ç»„ä»¶æˆ–å¼±ç‚¹

##### å®‰è£…çš„è½¯ä»¶åˆ—è¡¨

- windowsï¼š

  ```bash
  wmic product
  ```

- linux:

  ```bash
  dpkg -l
  rpm -qa
  ```

##### ä¸­é—´ä»¶æœåŠ¡

- Tomcat/Nginx/Apache
- PHP/Java/Pythonç‰ˆæœ¬
- æ•°æ®åº“ç‰ˆæœ¬
- è¿œç¨‹æœåŠ¡ï¼ˆVNCï¼‰

##### è‡ªå¯åŠ¨ç¨‹åº

- windowså¯åŠ¨é¡¹ã€æœåŠ¡è‡ªå¯åŠ¨
- linux systemdã€initã€crontab

### æ–‡ä»¶å’Œç›®å½•

å¸¸è§çš„æ•æ„Ÿæ–‡ä»¶ã€å¯åˆ©ç”¨æ–‡ä»¶ã€åé—¨æ–‡ä»¶ç­‰

- å¯ç–‘çš„è„šæœ¬ï¼ˆ.bat/.ps1/.shï¼‰
- æœ¬åœ°æ•æ„Ÿæ–‡ä»¶ï¼ˆå¯†ç æœ¬ã€é…ç½®æ–‡ä»¶ï¼‰
- Webè·¯å¾„ä¸­çš„é…ç½®æ–‡ä»¶
- æ—¥å¿—æ–‡ä»¶ï¼ˆå¯ç”¨æ¥æ‰¾å‡­æ®ï¼‰

#### ä»»åŠ¡è®¡åˆ’/Cron/è‡ªå¯åŠ¨

ææƒå’ŒæŒä¹…åŒ–å¸¸è§ç‚¹

- windowsè®¡åˆ’ä»»åŠ¡
- linux crontab/systemd timer
- å¯ä»¥æŒä¹…åŒ–ç‚¹

#### å®‰å…¨é˜²æŠ¤å’Œæ—¥å¿—

ç”¨æ¥åˆ¤æ–­å¦‚ä½•ç»•è¿‡é˜²æŠ¤å’Œè§„é¿æ£€æµ‹

- windows DefenderçŠ¶æ€
- æ€è½¯
- EDRæ˜¯å¦å¼€å¯
- é˜²ç«å¢™ç­–ç•¥
- å®¡è®¡ç­–ç•¥æƒ…å†µ

#### ç³»ç»Ÿæ¼æ´å’Œå¼±ç‚¹æ£€æµ‹

ç”¨äºåˆ¤æ–­å¯åˆ©ç”¨ç‚¹

- SUIDæ–‡ä»¶
- ä¸å®‰å…¨çš„æœåŠ¡æƒé™
- å¯å†™çš„æœåŠ¡è·¯å¾„/DLLåŠ«æŒç‚¹
- æœªä¿®è¡¥çš„é«˜å±è¡¥ä¸
- UACçŠ¶æ€
- å…±äº«ç›®å½•æƒé™é—®é¢˜

#### å®¹å™¨/è™šæ‹ŸåŒ–/äº‘ç¯å¢ƒæ ‡è¯†ï¼ˆå¦‚æœæœ‰ï¼‰

ç”¨æ¥åˆ¤æ–­æ˜¯å¦èƒ½é€ƒé€¸åˆ°å®¿ä¸»æœº

- å®¹å™¨è¿è¡Œç¯å¢ƒæ£€æµ‹ï¼ˆDockerã€LXCï¼‰
- è™šæ‹ŸåŒ–ä¿¡æ¯ï¼ˆVMwareã€Hyper-Vï¼‰
- äº‘å¹³å°å…ƒæ•°æ®æ£€æŸ¥ï¼ˆAWS/Aliyunï¼‰

## å·¥å…·

### peass-ng

é¡¹ç›®åœ°å€

https://github.com/peass-ng/PEASS-ng.git

ä¸‹è½½åˆ—è¡¨ä¸­æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œå…¶ä¸­linuxçš„ç‰ˆæœ¬ï¼š

![image-20251115141120932](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115141120984.png)

åˆ†åˆ«æ˜¯ä¸åŒæ¶æ„çš„ç‰ˆæœ¬ï¼Œæ²¡æœ‰åç¼€çš„æ˜¯ç¼–è¯‘å¥½çš„ç‰ˆæœ¬ï¼Œshæ˜¯è„šæœ¬ç‰ˆæœ¬ï¼Œå…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œå…¶ä¸­çš„fatä»£è¡¨åŠŸèƒ½å®Œæ•´ï¼Œsmallä»£è¡¨åªæœ‰ä¸»è¦çš„åŠŸèƒ½

å¯¹äºwindowsï¼š
![image-20251115141308730](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115141308777.png)

å…¶ä¸­batæ˜¯è„šæœ¬ç‰ˆæœ¬ï¼Œå…¼å®¹æ€§æ¯”è¾ƒå¥½ï¼Œå…¶ä¸­çš„anyæ˜¯å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬ï¼Œåç¼€ofsä»£è¡¨ä»£ç åšäº†æ··æ·†ï¼Œå¯ä»¥ç»•è¿‡ä¸€äº›å®‰å…¨è½¯ä»¶

##### ä½¿ç”¨æ–¹å¼

linuxï¼š

```bash
# ä¸Šä¼ linpeas_fat.shåˆ°ç›®æ ‡ä¸»æœº
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x linpeas_fat.sh
./linpeas_fat.sh
# ä¸Šé¢çš„å‘½ä»¤ä¼šå§æ”¶é›†çš„å†…å®¹æ‰“å°åœ¨ç»ˆç«¯
# éœ€è¦æ‰“å°åœ¨ç»ˆç«¯çš„åŒæ—¶ä¿å­˜ç»“æœæ–‡ä»¶
./linpeas_fat.sh -a | tee result.log
# è¿™ä¸ªfatè¿è¡Œæ—¶é—´æ¯”è¾ƒé•¿ï¼Œè€å¿ƒç­‰å¾…å°±å¥½äº†
# æŠŠè¿™ä¸ªè¾“å‡ºæ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ç”µè„‘ä¹‹åç”¨vscodeæ‰“å¼€ï¼Œè®°å¾—ä¸‹è½½iliazeusçš„ansi coloræ’ä»¶ï¼Œå¹¶è¿è¡Œï¼šANSI Text: Open Preview
# è¾“å‡ºæ— é¢œè‰²ç»“æœ
linpeas_fat.sh --no-color | tee result.log
```

![image-20251115145804813](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115145805037.png)

windowsï¼š

```bash
# å‘½ä»¤è¡Œè¿è¡Œ
winpeass.exe
# è¾“å‡ºç»“æœåˆ°æ–‡ä»¶
winpeass.exe > result.txt
# åœ¨ä¸€äº›æ¯”è¾ƒåƒåœ¾çš„æœºå™¨ä¸Šå¦‚æœæç¤ºè¯´ç¼ºå°‘.NETæ¡†æ¶çš„è¯å¯ä»¥è¿è¡Œ.batç‰ˆæœ¬çš„å·¥å…·
# ç­‰å¾…å·¥å…·è¿è¡Œçš„logç»“æœç»™vscodeçœ‹å°±å¯ä»¥äº†
# è¾“å‡ºæ— é¢œè‰²ç»“æœ
winpeas.bat --no-color
```

![image-20251115151203436](https://cdn.jsdelivr.net/gh/wudiloveyh/my-image-bucket@main/images/20251115151203709.png)



